---
title: "Welling_Spatial_Statistics_Assignment"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Spatial Modeling Assignment

```{r}
library(vegan)
data(BCI)
## UTM Coordinates (in metres)
BCI_xy = data.frame(x = rep(seq(625754, 626654, by=100), each=5), 
                    y = rep(seq(1011569,  1011969, by=100), len=50))
head(BCI)
```

1) Examine if there is evidence of spatial dependence in a rare and a common
species in the BCI tree dataset


```{r}
#looking at overall abundance of species
BCI_sum <- sapply(BCI, sum)
boxplot(BCI_sum)
plot(density(log10(BCI_total)))
abline(v=log10(25), col='red')

#What is the midpoint?
quantile(BCI_sum, 0.5)

BCI_total <- apply(BCI, 2, sum)

BCI_new <- rbind(BCI, BCI_total)

#subset data to where everything below the midpoint is rare, and everything above is common
common = BCI
for (i in ncol(BCI_new)) {
  sp_abundance = sum(BCI[,1])
  if (sp_abundance < 25)
    common = common[,-i]
}

rare = BCI
for (i in ncol(BCI_new)) {
  sp_abundance = sum(BCI[,1])
  if (sp_abundance > 25)
    rare = rare[,-i]
}

```
```{r}
#is there spatial dependence in rare versus abundant species?
sr1 <- apply(common, 1, function(x) sum(x>0))
sr1_dist <- dist(sr1)
xy_dist <- dist(BCI_xy)
max_dist = max(xy_dist) / 2

common_mantel <- mantel(sr1_dist, xy_dist)
common_mantel

plot(xy_dist, sr1_dist)
abline(lm(sr1_dist ~ xy_dist), lwd=3, col='red')
lines(lowess(xy_dist, sr1_dist), lwd=3, col='pink')
abline(v = max_dist, col='red', lwd=3, lty=2)
```


```{r}
sr2 <- apply(rare, 1, function(x) sum(x > 0))
sr2_dist <- dist(sr2)
xy_dist <- dist(BCI_xy)
max_dist = max(xy_dist) / 2

rare_mantel <- mantel(sr2_dist, xy_dist)
rare_mantel

plot(xy_dist, sr2_dist)
abline(lm(sr2_dist ~ xy_dist), lwd=3, col='red')
lines(lowess(xy_dist, sr2_dist), lwd=3, col='pink')
abline(v = max_dist, col='red', lwd=3, lty=2)

```
Neither seem to differ from the null model. So there doesn't seem to be spatial dependence for abundant, nor rare, species.


2) Build two generalized linear models to predict the abundance of the species
*Drypetes standleyi* using the abundance of other tree species in the study site.
Specifically examine the following species as predictor variables:

```{r}
#sp_ids = c("Cordia.lasiocalyx", "Hirtella.triandra",
#           "Picramnia.latifolia", "Quassia.amara",
#           "Tabernaemontana.arborea", "Trattinnickia.aspera", 
#           "Xylopia.macrantha")
```
Note renaming the species ids to something a little easier to work with like
"sp_a", "sp_b" will make model construction a little less cumbersome

* Model 1: only include a single species as a predictor variable

* Model 2: include all of the species as predictor variables

With both models examine the spatial dependence of the residuals using the 
function `Variogram`. Model the spatial dependence in the residuals using one
of the error structures available. 

* Did including the spatial error term have a large impact on the coefficients
of the model?

* Did including the spatial error terms significantly improve model fit (use 
function `anova` to carry out model comparison)?

* Explain why you did or did not observe a difference in the influence of adding the spatial error term between the two models.